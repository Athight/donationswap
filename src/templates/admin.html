<!doctype html>
<html lang="en">
<head>
<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/static/style.css">
<meta charset="utf-8">
<script src="/static/code.js"></script>
<style>
li {
	margin-bottom: 1em;
}
</style>
<title>Admin</title>
</head>
<body>
<h1>Admin</h1>
<ul>
	<li>
		Log in:<br>
		<input class="bordered" id="txtEmail" placeholder="Email Address"><br>
		<input class="bordered" id="txtPassword" placeholder="Password" type="password"><br>
		<button id="btnLogin" class="purple">Login</button>
	</li>
	<li>
		Log out:<br>
		<button id="btnLogout" class="purple">Logout</button>
	</li>
	<li>
		Change password:<br>
		<input class="bordered" id="txtOldPassword" placeholder="Old Password" type="password"><br>
		<input class="bordered" id="txtNewPassword" placeholder="New Password" type="password"><br>
		<button id="btnChangePassword" class="purple">Change Password</button>
	</li>
	<li>
		<a href="/special-secret-admin/data-edit.html" target="_blank">Charities and Countries</a>
	</li>
	<li>
		<a href="/special-secret-admin/unmatched-offers.html" target="_blank">Unmatched Offers</a>
	</li>
	<li>
		<a href="/special-secret-admin/eventlog.html" target="_blank">Eventlog</a>
	</li>
</ul>
<script>
/* globals ajax, getElementsById */
/* jshint esversion: 6 */
(function () {
	'use strict';

	const ui = getElementsById();

	function handleError(response) {
		console.error(response);
		alert(`Error: ${response}`);
	}

	ui.btnLogin.onclick = () => {
		ajax('/ajax/login', {
			email: ui.txtEmail.value,
			password: ui.txtPassword.value,
		})
			.then(() => {
				ui.txtEmail.value = '';
				ui.txtPassword.value = '';
				alert('You are now logged in.');
			})
			.catch(() => {
				alert('Error. Wrong username? Wrong password?');
			});
	};

	ui.btnLogout.onclick = () => {
		ajax('/special-secret-admin/logout')
			.then(() => {
				alert('You are now logged out.');
			})
			.catch(handleError);
	};

	ui.btnChangePassword.onclick = () => {
		ajax('/special-secret-admin/change_password', {
			old_password: ui.txtOldPassword.value,
			new_password: ui.txtNewPassword.value,
		})
			.then(() => {
				ui.txtOldPassword.value = '';
				ui.txtNewPassword.value = '';
				alert('Your password has been changed.');
			})
			.catch(handleError);
	};
}());
</script>
</body>
</html>
